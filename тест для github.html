<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Калькулятор реальной ставки</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg1: #667eea;
      --bg2: #764ba2;
      --text-primary: #1a202c;
      --text-secondary: #5a6474;
      --border-color: #e2e8f0;
      --input-bg: #ffffff;
      --card-bg: #ffffff;
      --shadow-color: rgba(102, 126, 234, 0.15);
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --radius-lg: 20px;
      --radius-md: 12px;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --text-primary: #e2e8f0;
        --text-secondary: #a0aec0;
        --border-color: #4a5568;
        --input-bg: #2d3748;
        --card-bg: #1a202c;
        --shadow-color: rgba(0, 0, 0, 0.2);
      }
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation: none !important; transition: none !important; }
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: #f7fafc;
      background-image: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: var(--text-primary);
    }
    
    .calculator-container {
      background-color: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 32px;
      box-shadow: 0 25px 50px -12px var(--shadow-color);
      max-width: 580px;
      width: 100%;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .header {
      text-align: center;
      margin-bottom: 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }
    .header h1 {
      font-size: 26px;
      font-weight: 800;
    }
    .header p {
      color: var(--text-secondary);
      font-size: 16px;
    }
    
    form { display: grid; gap: 20px; }
    
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    @media(max-width: 600px) { .row { grid-template-columns: 1fr; } }

    .input-group { position: relative; }
    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-primary);
      font-weight: 600;
      font-size: 14px;
    }
    .input-group .icon {
      position: absolute;
      left: 14px;
      top: 42px;
      width: 20px;
      height: 20px;
      color: var(--text-secondary);
      pointer-events: none;
    }
    .input-group input {
      width: 100%;
      padding: 14px 14px 14px 44px; /* Left padding for icon */
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 16px;
      font-family: 'Inter', sans-serif;
      background-color: var(--input-bg);
      color: var(--text-primary);
      transition: border-color .2s, box-shadow .2s;
    }
    .input-group input:focus {
      outline: none;
      border-color: var(--bg1);
      box-shadow: 0 0 0 3px var(--shadow-color);
    }

    .actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 10px;
    }
    .btn {
        appearance: none;
        border: none;
        border-radius: var(--radius-md);
        padding: 14px 24px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: transform .15s, box-shadow .2s, background-size .3s;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    .btn .icon { width: 20px; height: 20px; }
    .btn.primary {
        color: #fff;
        background: linear-gradient(135deg, #764ba2 0%, #667eea 50%, #764ba2 100%);
        background-size: 200% 100%;
        box-shadow: 0 10px 20px -5px var(--shadow-color);
    }
    .btn.primary:hover {
        background-position: 100% 0;
        transform: translateY(-2px);
        box-shadow: 0 12px 25px -5px var(--shadow-color);
    }
    .btn.secondary {
        background-color: var(--input-bg);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }
    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .result-container {
        margin-top: 24px;
        opacity: 0;
        transform: translateY(15px);
        transition: opacity .4s ease, transform .4s ease;
        background-image: url('data:image/svg+xml;utf8,<svg width="200" height="200" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="business-pattern" patternUnits="userSpaceOnUse" width="100" height="100" patternTransform="rotate(45)"><path d="M 50 0 L 100 50 L 50 100 L 0 50 Z" fill="none" stroke="%23667eea" stroke-width="0.75" opacity="0.12"/><circle cx="50" cy="50" r="2" fill="%23764ba2" opacity="0.15"/><path d="M -10 25 L 110 25" stroke="%236d65b7" stroke-width="0.5" stroke-dasharray="2 8" opacity="0.1"/><path d="M 25 -10 L 25 110" stroke="%236d65b7" stroke-width="0.5" stroke-dasharray="2 8" opacity="0.1"/></pattern></defs><rect width="100%" height="100%" fill="url(%23business-pattern)" /></svg>');
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 24px;
        text-align: center;
    }
    .result-container.show {
        opacity: 1;
        transform: translateY(0);
    }
    
    .result-graphic { margin-bottom: 16px; }
    .result-graphic svg { width: 80px; height: 80px; }
    .result-graphic > div { display: none; }
    .result-graphic > div.active { display: block; }
    
    .result-text h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-secondary);
        margin-bottom: 8px;
    }
    .result-amount {
        font-size: 42px;
        font-weight: 800;
        line-height: 1.1;
        background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 12px;
    }
    .result-line { font-size: 15px; color: var(--text-secondary); }

    .insight {
        margin-top: 16px;
        padding: 16px;
        border-radius: var(--radius-md);
        border-left: 4px solid;
        opacity: 0;
        transform: translateY(15px);
        transition: all .4s ease .1s;
    }
    .insight.show { opacity: 1; transform: translateY(0); }
    .insight p { line-height: 1.6; font-size: 14px; }

    .insight.success { background-color: rgba(40, 167, 69, 0.05); border-color: var(--success); }
    .insight.warning { background-color: rgba(255, 193, 7, 0.05); border-color: var(--warning); }
    .insight.danger { background-color: rgba(220, 53, 69, 0.05); border-color: var(--danger); }
    
    .error {
        background: rgba(220, 53, 69, 0.1);
        color: var(--danger);
        border: 1px solid rgba(220, 53, 69, 0.2);
        border-radius: var(--radius-md);
        padding: 12px 16px;
        font-size: 14px;
        display: none;
    }
    .meta { margin-top: 24px; color: var(--text-secondary); opacity: .8; font-size: 12px; text-align: center; }
  </style>
</head>
<body>
  <main class="calculator-container" role="main" aria-labelledby="title">
    <header class="header">
        <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <defs><linearGradient id="header-gradient" x1="0" y1="0" x2="64" y2="64" gradientUnits="userSpaceOnUse"><stop stop-color="#667EEA"/><stop offset="1" stop-color="#764BA2"/></linearGradient></defs>
            <rect width="64" height="64" rx="12" fill="url(#header-gradient)"/>
            <path d="M21.5 16H42.5C44.7091 16 46.5 17.7909 46.5 20V44C46.5 46.2091 44.7091 48 42.5 48H21.5C19.2909 48 17.5 46.2091 17.5 44V20C17.5 17.7909 19.2909 16 21.5 16Z" fill="white" fill-opacity="0.1"/>
            <path d="M31.1818 20.5H41.8182C43.0233 20.5 44 21.4767 44 22.6818V28.3182C44 29.5233 43.0233 30.5 41.8182 30.5H31.1818C29.9767 30.5 29 29.5233 29 28.3182V22.6818C29 21.4767 29.9767 20.5 31.1818 20.5Z" fill="white" fill-opacity="0.8"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M25.5455 35.1364C25.5455 34.2571 26.2571 33.5455 27.1364 33.5455H28.4091V35.1364H27.1364V36.7273H28.4091V38.3182H27.1364V40.1818H28.4091V41.7727H27.1364C26.2571 41.7727 25.5455 41.0612 25.5455 40.1818V35.1364ZM23 37.7727C23 36.3236 24.1136 35.1364 25.5455 35.1364V40.1818C24.1136 40.1818 23 38.9953 23 37.7727Z" fill="white"/>
            <path d="M22 25.75C22 24.5074 23.0074 23.5 24.25 23.5H24.75C25.9926 23.5 27 24.5074 27 25.75V25.75C27 26.9926 25.9926 28 24.75 28H24.25C23.0074 28 22 26.9926 22 25.75V25.75Z" fill="white"/>
            <path d="M24.5 28V30.5" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
        </svg>
      <h1 id="title">Калькулятор реальной ставки</h1>
      <p>Рассчитайте настоящую стоимость вашего часа</p>
    </header>

    <form id="calculatorForm" novalidate>
      <div class="error" id="errorBox" role="alert" aria-live="polite"></div>

      <div class="input-group">
        <div class="icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 6V5C14 3.89543 13.1046 3 12 3H10C8.89543 3 8 3.89543 8 5V6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 13L12 9L8 13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 9V17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><rect x="3" y="6" width="18" height="15" rx="2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
        <label for="monthlyIncome">Месячный доход бизнеса (₽)</label>
        <input inputmode="numeric" id="monthlyIncome" name="monthlyIncome" placeholder="Например: 2 000 000" required>
      </div>

      <div class="row">
        <div class="input-group">
          <div class="icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3V12H21Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M15.5 15.5L18.5 18.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><circle cx="15" cy="18" r="1" fill="currentColor"/><circle cx="19" cy="15" r="1" fill="currentColor"/></svg></div>
          <label for="ownerShare">Ваша доля от дохода (%)</label>
          <input type="number" id="ownerShare" name="ownerShare" placeholder="Например: 30" min="1" max="100" required>
        </div>
        <div class="input-group">
          <div class="icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 8V12L14.5 14.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
          <label for="monthlyHours">Часов работы в месяц</label>
          <input type="number" id="monthlyHours" name="monthlyHours" placeholder="Например: 200" min="1" required>
        </div>
      </div>
      
      <div class="actions">
        <button type="button" class="btn primary" id="calcBtn" onclick="calcAndSave()">
          <div class="icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7L7 12L12 17L17 12L22 7L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 12L2 22L12 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M17 12L22 22L12 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
          Рассчитать
        </button>
        <button type="button" class="btn secondary" id="pdfBtn" onclick="savePDF()" disabled>Сохранить PDF</button>
      </div>
    </form>

    <div id="resultContainer" class="result-container" aria-live="polite">
        <div class="result-graphic" id="resultGraphic">
            <div id="graphicSuccess">
                <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="trophy-gradient" x1="40" y1="10" x2="40" y2="70" gradientUnits="userSpaceOnUse"><stop stop-color="#FFD700"/><stop offset="1" stop-color="#FFA500"/></linearGradient></defs><path d="M60 15H55V25C55 27.7614 52.7614 30 50 30H30C27.2386 30 25 27.7614 25 25V15H20C17.2386 15 15 17.2386 15 20V30H65V20C65 17.2386 62.7614 15 60 15Z" fill="url(#trophy-gradient)"/><path d="M40 30V50" stroke="url(#trophy-gradient)" stroke-width="4" stroke-linecap="round"/><rect x="25" y="50" width="30" height="10" rx="3" fill="url(#trophy-gradient)"/><rect x="20" y="60" width="40" height="5" rx="2.5" fill="url(#trophy-gradient)"/><circle cx="15" cy="55" r="7" fill="#FFD700" stroke="#B8860B" stroke-width="1.5"/><text x="15" y="58" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="#B8860B" text-anchor="middle">₽</text><circle cx="65" cy="50" r="9" fill="#FFD700" stroke="#B8860B" stroke-width="1.5"/><text x="65" y="54" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="#B8860B" text-anchor="middle">$</text></svg>
            </div>
            <div id="graphicWarning">
                <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M40 5.35898L75.3205 70H4.67949L40 5.35898Z" fill="#FFC107"/><path d="M40 5.35898L75.3205 70H4.67949L40 5.35898Z" stroke="#856404" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><circle cx="40" cy="45" r="12" fill="none" stroke="#FFFFFF" stroke-width="3"/><path d="M40 38V45H47" stroke="#FFFFFF" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
            <div id="graphicDanger">
                <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="40" cy="40" r="35" fill="#DC3545"/><circle cx="40" cy="40" r="35" stroke="#721C24" stroke-width="3"/><path d="M25 55L35 45L45 50L55 30" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M48 30H55V37" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
        </div>
        <div class="result-text">
            <h3>Стоимость вашего часа:</h3>
            <div id="hourlyRate" class="result-amount">0 ₽</div>
            <div class="result-line" id="dailyRate"></div>
        </div>
    </div>
    
    <div id="insight" class="insight" aria-live="polite">
        <p id="insightText"></p>
    </div>

    <div class="meta" id="metaInfo"></div>
  </main>

  <script>
    "use strict";

    const byId = id => document.getElementById(id);

    // Cache DOM elements
    const $form = byId('calculatorForm');
    const $error = byId('errorBox');
    const $resultContainer = byId('resultContainer');
    const $resultGraphic = byId('resultGraphic');
    const $insight = byId('insight');
    const $insightText = byId('insightText');
    const $hourly = byId('hourlyRate');
    const $daily = byId('dailyRate');
    const $calcBtn = byId('calcBtn');
    const $pdfBtn = byId('pdfBtn');
    const $meta = byId('metaInfo');
    
    const inputs = {
      monthlyIncome: byId('monthlyIncome'),
      ownerShare: byId('ownerShare'),
      monthlyHours: byId('monthlyHours')
    };
    
    const graphics = {
        success: byId('graphicSuccess'),
        warning: byId('graphicWarning'),
        danger: byId('graphicDanger')
    };
    
    const nf = new Intl.NumberFormat('ru-RU');
    const STORAGE_KEY = 'business-hour-calculator:v1';

    const parseNumber = (value) => {
      let v = String(value || '').replace(/\s+/g,'').replace(',', '.');
      const num = parseFloat(v);
      return Number.isFinite(num) ? num : NaN;
    };

    const debounce = (fn, ms = 300) => {
      let timer;
      return (...args) => {
        clearTimeout(timer);
        timer = setTimeout(() => fn.apply(this, args), ms);
      };
    };

    const saveState = () => {
      const state = {};
      for (const key in inputs) {
        state[key] = inputs[key].value;
      }
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.warn("Could not save state to localStorage.", e);
      }
    };
    
    const loadState = () => {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const state = JSON.parse(raw);
        for (const key in state) {
          if (inputs[key]) {
            inputs[key].value = state[key];
          }
        }
      } catch (e) {
        console.warn("Could not load state from localStorage.", e);
      }
    };

    function displayResult(rateData) {
        const { hourlyRate } = rateData;

        // Update text content
        $hourly.textContent = nf.format(Math.round(hourlyRate)) + ' ₽';
        $daily.innerHTML = `Примерный дневной заработок: <strong>${nf.format(Math.round(hourlyRate * 8))} ₽</strong>`;

        // Determine state and message
        let state, message;
        if (hourlyRate >= 5000) {
            state = 'success';
            message = `Отличный результат! Задачи, которые стоят дешевле ${nf.format(Math.round(hourlyRate*0.3))} ₽/ч, следует делегировать, чтобы не терять в деньгах.`;
        } else if (hourlyRate >= 2000) {
            state = 'warning';
            message = `Хороший показатель. Однако рутинные задачи (согласования, административная работа) могут быть убыточны. Стоит составить план по делегированию.`;
        } else {
            state = 'danger';
            message = `Ставка ниже рыночной для собственника. Это может быть сигналом к пересмотру доли прибыли, увеличению маржинальности или оптимизации рабочих часов.`;
        }

        // Update UI based on state
        Object.values(graphics).forEach(el => el.classList.remove('active'));
        if (graphics[state]) graphics[state].classList.add('active');

        $insight.className = `insight ${state}`;
        $insightText.textContent = message;

        $resultContainer.classList.add('show');
        setTimeout(() => $insight.classList.add('show'), 50);

        $pdfBtn.disabled = false;
        $meta.textContent = `Расчет обновлен: ${new Date().toLocaleString('ru-RU')}`;
    }
    
    function validateAndCalc() {
      $error.style.display = 'none';
      let problems = [];

      const monthlyIncome = parseNumber(inputs.monthlyIncome.value);
      const ownerShare = parseNumber(inputs.ownerShare.value);
      const monthlyHours = parseNumber(inputs.monthlyHours.value);

      if (!Number.isFinite(monthlyIncome) || monthlyIncome <= 0) problems.push('Укажите корректный месячный доход (> 0).');
      if (!Number.isFinite(ownerShare) || ownerShare <= 0 || ownerShare > 100) problems.push('Доля должна быть в диапазоне от 1 до 100%.');
      if (!Number.isFinite(monthlyHours) || monthlyHours <= 0) problems.push('Количество часов в месяц должно быть больше 0.');

      if (problems.length) {
        $error.innerHTML = problems.join('<br>');
        $error.style.display = 'block';
        $resultContainer.classList.remove('show');
        $insight.classList.remove('show');
        $pdfBtn.disabled = true;
        return null;
      }
      
      const ownerIncome = monthlyIncome * (ownerShare / 100);
      const hourlyRate = ownerIncome / monthlyHours;

      const resultData = { hourlyRate };
      displayResult(resultData);
      return resultData;
    }

    const calcAndSave = () => {
        const result = validateAndCalc();
        if (result) saveState();
    };

    const calcDebounced = debounce(calcAndSave, 350);
    
    async function savePDF() {
        const result = validateAndCalc();
        if (!result) return;
        
        $pdfBtn.textContent = 'Генерация...';
        $pdfBtn.disabled = true;

        if (!window.html2pdf) {
            const script = document.createElement('script');
            script.src = "https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js";
            document.head.appendChild(script);
            await new Promise(resolve => script.onload = resolve);
        }

        const reportElement = document.createElement('div');
        reportElement.style.padding = '25px';
        reportElement.style.fontFamily = 'Inter, sans-serif';
        reportElement.innerHTML = `
            <h2 style="font-size: 20px; margin:0 0 10px 0;">Расчет стоимости часа</h2>
            <p style="font-size:12px;color:#555;margin-bottom:20px;">Дата отчета: ${new Date().toLocaleString('ru-RU')}</p>
            <table style="width:100%; border-collapse: collapse; font-size:14px;">
                <tr style="border-bottom: 1px solid #eee;"><td style="padding: 8px 0; color: #555;">Месячный доход бизнеса:</td><td style="padding: 8px 0; text-align:right; font-weight: bold;">${nf.format(parseNumber(inputs.monthlyIncome.value))} ₽</td></tr>
                <tr style="border-bottom: 1px solid #eee;"><td style="padding: 8px 0; color: #555;">Доля собственника:</td><td style="padding: 8px 0; text-align:right; font-weight: bold;">${inputs.ownerShare.value}%</td></tr>
                <tr style="border-bottom: 1px solid #eee;"><td style="padding: 8px 0; color: #555;">Часов в месяц:</td><td style="padding: 8px 0; text-align:right; font-weight: bold;">${inputs.monthlyHours.value}</td></tr>
            </table>
            <div style="margin-top:25px; padding:20px; border-radius:12px; background-color: #f7f9fc; text-align:center;">
                <p style="margin:0; font-size:14px; color: #555;">Стоимость часа:</p>
                <p style="margin:5px 0 0 0; font-size: 28px; font-weight: 800; color:#1a202c;">${nf.format(Math.round(result.hourlyRate))} ₽</p>
            </div>
            <div style="margin-top:20px;padding:15px;border-left:4px solid #${$insight.classList.contains('success') ? '28a745' : $insight.classList.contains('warning') ? 'ffc107' : 'dc3545'};background-color:#f7f9fc;">
                <p style="margin:0;font-size:14px;line-height:1.5;"><strong>Инсайт:</strong> ${$insightText.textContent}</p>
            </div>
        `;

        const filename = `hourly_rate_report_${new Date().toISOString().slice(0,10)}.pdf`;
        try {
            await html2pdf().from(reportElement).set({
                margin: 20, filename, image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            }).save();
        } catch(e) {
            alert('Не удалось создать PDF. Пожалуйста, попробуйте снова.');
            console.error(e);
        } finally {
            $pdfBtn.textContent = 'Сохранить PDF';
            $pdfBtn.disabled = false;
        }
    }